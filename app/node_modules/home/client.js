var dom = require('dom-events');
var classList = require('class-list');
var q = require('hyperquest');

var addBtn = document.querySelector('.add');
var closeBtn = document.querySelector('.modal-close');
var okBtn = document.querySelector('.modal-ok');
var projectInput = document.querySelector('.project-name');
var responseP = document.querySelector('.response p');
var addModal = document.querySelector('.modal');
var addModalCL = classList(addModal);
var unauthorizedP = document.querySelector('.unauthorized p');

function streamReader(stream) {
  stream.on('json', function(data) {
    if (data.addProject) {
      if (data.addProject.error) {
        responseP.innerHTML = data.addProject.error;
        return;
      }
      location.reload();
    }

    if (data.error) {
      unauthorizedP.innerHTML = data.error;
    }
  });
}

function Reload(stream) {

  streamReader(stream)
}

function Load(stream) {

  dom.on(addBtn, 'click', function() {
    return addModalCL.add('modal-show');
  });

  dom.on(closeBtn, 'click', function() {
    return addModalCL.remove('modal-show');
  });

  dom.on(okBtn, 'click', function() {

    if (projectInput.value == '') {
      responseP.innerHTML = 'Must have a name';
      return;
    }

    stream.write({
      page: 'home',
      addProject: projectInput.value
    });
  });

  streamReader(stream)
  module.exports = Reload;
};

module.exports = Load;

